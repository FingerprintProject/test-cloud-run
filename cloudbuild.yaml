steps:
  - name: gcr.io/cloud-builders/docker
    args:
      - build
      - "-t"
      - "asia-southeast1-docker.pkg.dev/$PROJECT_ID/ml-docker-repo/laravel_test:latest"
      - .
      - "-f"
      - "./docker/dockerfile.php"
    id: Build

  - name: gcr.io/cloud-builders/docker
    args:
      - push
      - "asia-southeast1-docker.pkg.dev/$PROJECT_ID/ml-docker-repo/laravel_test:latest"
    id: Push

  - name: gcr.io/cloud-builders/gcloud
    args:
      - run
      - deploy
      - fingperint-server
      - --image=asia-southeast1-docker.pkg.dev/machine-learning-399007/ml-docker-repo/laravel_test:latest
      - --region=$asia-southeast1
      - --platform=managed
      - --allow-unauthenticated

images:
  - "asia-southeast1-docker.pkg.dev/$PROJECT_ID/ml-docker-repo/laravel_test:latest"
